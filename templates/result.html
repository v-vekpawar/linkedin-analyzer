<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Result - LinkedIn Profile Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/result_style.css') }}">
</head>

<body>
    <div class="dashboard-container">
        <div class="dashboard-grid">

            <!-- LEFT SIDEBAR: Pofile Cards -->
            <div class="sidebar">
                <!-- Target Profile -->
                <div class="li-card profile-card">
                    <div class="li-card-body">
                        <div class="profile-avatar-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                        <h2 class="profile-name">{{ profile_data.name }}</h2>
                        <p class="profile-headline">{{ profile_data.headline }}</p>
                        <a href="{{ profile_data.url }}" target="_blank" class="profile-link">
                            View LinkedIn Profile <i class="fas fa-external-link-alt"
                                style="font-size:0.8rem; margin-left:4px;"></i>
                        </a>

                        {% if profile_data.skills %}
                        <div class="skills-wrapper">
                            {% for skill in profile_data.skills[:4] %}
                            <span class="skill-chip">{{ skill }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- User Profile (Only for compatibility mode) -->
                {% if analysis_result.mode == 'compatibility_score' and user_data %}
                <div class="li-card profile-card">
                    <div class="li-card-body">
                        <div class="profile-avatar-placeholder" style="background: #e3f2fd; color: #0a66c2;">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h2 class="profile-name">You: {{ user_data.name }}</h2>
                        <p class="profile-headline">{{ user_data.headline }}</p>
                        <a href="{{ user_data.url }}" target="_blank" class="profile-link">
                            View Your Profile <i class="fas fa-external-link-alt"
                                style="font-size:0.8rem; margin-left:4px;"></i>
                        </a>

                        {% if user_data.skills %}
                        <div class="skills-wrapper">
                            {% for skill in user_data.skills[:4] %}
                            <span class="skill-chip">{{ skill }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- RIGHT COLUMN: AI Results -->
            <div class="main-content" id="ai-results-container">
                <div class="li-card">

                    {% set result = analysis_result.result %}

                    <!-- ABOUT PROFILE MODE -->
                    {% if analysis_result.mode == 'about_profile' %}
                    <div class="banner-top">
                        <h2>Executive Summary</h2>
                        <div class="text-white mt-1">{{ result.who_they_are }}</div>
                        <div class="seniority-ribbon">{{ result.seniority_level }} Profile</div>
                    </div>

                    <div class="split-view">
                        <div class="strengths-col">
                            <h3 class="section-title">Key Strengths</h3>
                            <ul class="strengths-list">
                                {% for strength in result.key_strengths %}
                                <li>{{ strength }}</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <div class="career-col">
                            <h3 class="section-title">Career Journey</h3>
                            <div class="timeline">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">{{ result.career_trajectory }}</div>
                            </div>
                        </div>
                    </div>

                    <div class="yellow-callout">
                        <i class="far fa-lightbulb"></i>
                        <div class="yellow-callout-text">
                            <h4>Conversation Starters</h4>
                            <p>{{ result.potential_talking_points }}</p>
                        </div>
                    </div>

                    <!-- APPROACH PERSON MODE -->
                    {% elif analysis_result.mode == 'approach_person' %}
                    <div class="border-bottom p-4">
                        <h3 class="section-title mb-0">Suggested Outreach Angles</h3>
                    </div>
                    <div class="angles-grid">
                        {% for angle in result.outreach_angles %}
                        <div class="angle-card">
                            <h5>{{ angle.angle_type }}</h5>
                            <p>{{ angle.explanation }}</p>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="border-top border-bottom p-4 bg-light">
                        <h3 class="section-title mb-0">Message Templates</h3>
                    </div>
                    <div class="messages-section mt-3">
                        <ul class="nav nav-tabs" id="msgTabs" role="tablist">
                            <!-- Dynamically create tabs based on available messages -->
                            {% set ns = namespace(active=false) %}
                            {% for key, msg in result.personalized_messages.items() %}
                            {% if msg and msg|length > 0 %}
                            <li class="nav-item" role="presentation">
                                <button
                                    class="nav-link {% if not ns.active %}active{% set ns.active = true %}{% endif %}"
                                    id="tab-{{ key }}" data-bs-toggle="tab" data-bs-target="#pane-{{ key }}"
                                    type="button" role="tab">
                                    {{ key.replace('_', ' ').title() }}
                                </button>
                            </li>
                            {% endif %}
                            {% endfor %}
                        </ul>

                        <div class="tab-content" id="msgTabsContent">
                            {% set ns2 = namespace(active=false) %}
                            {% for key, msg in result.personalized_messages.items() %}
                            {% if msg and msg|length > 0 %}
                            <div class="tab-pane fade {% if not ns2.active %}show active{% set ns2.active = true %}{% endif %}"
                                id="pane-{{ key }}" role="tabpanel">
                                <div class="position-relative">
                                    <div class="message-box pe-5">{{ msg }}</div>
                                    <button
                                        class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-3 copy-msg-btn"
                                        onclick="copySingleMessage(this)" title="Copy this message">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    <!-- COMPATIBILITY SCORE MODE -->
                    {% elif analysis_result.mode == 'compatibility_score' %}
                    <div style="text-align:center; padding-top: 2rem;">
                        <h3
                            style="color: var(--li-text-muted); font-size: 1.1rem; text-transform:uppercase; letter-spacing:1px; margin-bottom: 2rem;">
                            Match Analysis</h3>
                    </div>

                    <div class="score-container">
                        <div class="circular-progress" style="--progress: {{ result.compatibility_score }}%;">
                            <span class="progress-value">{{ result.compatibility_score }}</span><span
                                style="font-size: 1.5rem; font-weight: bold; color: #057642; margin-top:-10px;">%</span>
                        </div>

                        <div style="width: 100%; max-width: 600px; margin-top:1rem;">
                            <h3 class="section-title">Why this score?</h3>
                            <ul class="strengths-list">
                                {% for point in result.why %}
                                <li>{{ point }}</li>
                                {% endfor %}
                            </ul>

                            <div
                                class="recommendation-alert {% if 'no' in result.recommendation.lower() %}no{% endif %}">
                                <strong>Recommendation:</strong> {{ result.recommendation }}
                            </div>
                        </div>
                    </div>

                    {% else %}
                    <!-- Fallback if JSON is somehow broken -->
                    <div class="p-4">
                        <pre style="white-space:pre-wrap;">{{ result.raw_text or result }}</pre>
                    </div>
                    {% endif %}

                    <!-- Action Bar -->
                    <div class="action-bar">
                        <a href="{{ url_for('index') }}" class="btn-li-secondary">Analyze Another</a>
                        <button class="btn-li-primary" id="copyBtn" onclick="copyResults()">Copy Data</button>
                    </div>

                </div>
            </div>

        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/result_script.js') }}"></script>
</body>

</html>